<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cestovn√≠ pl√°novaƒç</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Application CSS -->
    <link rel="stylesheet" href="css/main.css">

    <!-- External Dependencies (CDN) -->
    <!-- LZString pro kompresi URL -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
    <!-- html2canvas pro export PNG -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Ace Editor pro JSON editaci -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/mode-json.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/theme-tomorrow.js"></script>
    <!-- date-fns pro pr√°ci s datumy -->
    <script src="https://cdn.jsdelivr.net/npm/date-fns@4.1.0/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@4.1.0/locale/cs/cdn.min.js"></script>
    <!-- Zod pro validaci -->
    <script src="https://cdn.jsdelivr.net/npm/zod@3.24.1/lib/index.umd.min.js"></script>
    <!-- marked pro Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@15.0.6/marked.min.js"></script>
    <!-- DOMPurify pro XSS ochranu -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.3/dist/purify.min.js"></script>
    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <div id="map"></div>
        <div class="sidebar app-hidden" id="sidebar">
            <div class="header">
                <h1 id="tripTitle"><span class="emoji" id="tripEmoji"></span> <span id="tripName"></span></h1>
                <div class="subtitle" id="tripDates"></div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" id="shareBtn" title="Sd√≠let pl√°n">
                    <span>Sd√≠let</span>
                </button>
                <button class="action-btn" id="editJsonBtn" title="Upravit JSON">
                    <span>Upravit JSON</span>
                </button>
                <div class="dropdown" id="exportDropdown">
                    <button class="action-btn" id="exportBtn" title="Export">
                        <span>Export ‚ñæ</span>
                    </button>
                    <div class="dropdown-content">
                        <button class="dropdown-item" id="exportPngBtn">Exportovat PNG</button>
                        <button class="dropdown-item" id="printBtn">Tisk</button>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-item">
                    <input type="checkbox" id="showRoutes" checked>
                    <label for="showRoutes">Zobrazit spojnice trasy</label>
                </div>
                <div class="control-item">
                    <input type="checkbox" id="showLabels" checked>
                    <label for="showLabels">Zobrazit popisky na mapƒõ</label>
                </div>
            </div>

            <div class="timeline" id="timeline"></div>

            <div class="stats" id="stats">
                <h3><span class="emoji">Statistiky cesty</span></h3>
                <div class="stat-row">
                    <span class="stat-label">Celkov√° d√©lka</span>
                    <span class="stat-value" id="statNights">0 noc√≠</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Poƒçet zast√°vek</span>
                    <span class="stat-value" id="statStops">0 m√≠st</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobiln√≠ p≈ôep√≠naƒç -->
    <button class="mobile-toggle" id="mobileToggle">Zobrazit seznam</button>

    <!-- Toast notifikace -->
    <div class="toast" id="toast"></div>

    <!-- Input modal -->
    <div class="modal-overlay" id="inputModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Zadejte cestovn√≠ pl√°n</h2>
                <p>Vytvo≈ôte pl√°n vizu√°lnƒõ nebo vlo≈æte JSON.</p>
            </div>
            <div class="modal-body">
                <!-- Tab switcher -->
                <div class="editor-tabs">
                    <button class="editor-tab active" data-mode="visual">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                        </svg>
                        Vizu√°ln√≠ editor
                    </button>
                    <button class="editor-tab" data-mode="code">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                        JSON k√≥d
                    </button>
                </div>

                <div class="error-summary" id="errorSummary">
                    <h4>Nalezeny chyby:</h4>
                    <ul id="errorList"></ul>
                </div>

                <!-- Visual Editor -->
                <div class="visual-editor">
                    <div class="visual-editor-stats">
                        <div class="visual-editor-stat">Zast√°vky: <strong id="inputStatsStops">0</strong></div>
                        <div class="visual-editor-stat">Noc√≠: <strong id="inputStatsNights">0</strong></div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Z√°kladn√≠ informace</h3>
                        <div class="form-group">
                            <label for="inputPlanName">N√°zev pl√°nu *</label>
                            <input type="text" id="inputPlanName" class="form-input" placeholder="nap≈ô. üè∞ V√≠kend v Praze">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="inputPlanDateFrom">Datum od</label>
                                <input type="date" id="inputPlanDateFrom" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="inputPlanDateTo">Datum do</label>
                                <input type="date" id="inputPlanDateTo" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-header">
                            <h3 class="form-section-title">Zast√°vky</h3>
                            <button type="button" class="btn-add-stop" id="inputAddStopBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                P≈ôidat zast√°vku
                            </button>
                        </div>
                        <div class="stops-list" id="inputStopsList"></div>
                    </div>
                </div>

                <!-- Code Editor -->
                <div class="code-editor">
                    <div class="drop-zone" id="dropZone">
                        <div class="drop-zone-icon">üìÅ</div>
                        <div class="drop-zone-text">P≈ôet√°hnƒõte sem JSON soubor</div>
                        <div class="drop-zone-subtext">nebo kliknƒõte pro v√Ωbƒõr souboru</div>
                        <input type="file" class="file-input" id="fileInput" accept=".json,application/json">
                    </div>

                    <div class="ace-editor-container" id="jsonInputContainer"></div>

                    <button class="example-toggle" id="exampleToggle">Zobrazit uk√°zkov√Ω JSON</button>
                    <div class="example-json" id="exampleJson" style="display: none;">
<pre>{
  "name": "üè∞ V√≠kend v Praze",
  "stops": [
    {
      "name": "Praha - Star√© Mƒõsto",
      "lat": 50.0875,
      "lng": 14.4214,
      "dateFrom": "2025-03-01",
      "dateTo": "2025-03-02"
    },
    {
      "name": "Karl≈°tejn",
      "lat": 49.9394,
      "lng": 14.1883,
      "dateTo": "2025-03-02",
      "notes": "Jednodenn√≠ v√Ωlet"
    },
    {
      "name": "Praha - Leti≈°tƒõ",
      "lat": 50.1008,
      "lng": 14.2600,
      "dateFrom": "2025-03-02",
      "dateTo": "2025-03-03"
    }
  ]
}</pre>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="useExampleBtn">Pou≈æ√≠t uk√°zku</button>
                <button class="btn btn-primary" id="loadJsonBtn">Naƒç√≠st pl√°n</button>
            </div>
        </div>
    </div>

    <!-- Recovery modal -->
    <div class="modal-overlay" id="recoveryModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Obnovit p≈ôedchoz√≠ pl√°n?</h2>
            </div>
            <div class="modal-body">
                <div class="recovery-info">
                    <h3 id="recoveryName"></h3>
                    <p id="recoveryDetails"></p>
                </div>
                <p style="font-size: 0.875rem; color: var(--text-secondary);">
                    M√°te ulo≈æen√Ω cestovn√≠ pl√°n z p≈ôedchoz√≠ n√°v≈°tƒõvy. Chcete ho obnovit nebo zaƒç√≠t znovu?
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="startNewBtn">Zaƒç√≠t znovu</button>
                <button class="btn btn-primary" id="recoverBtn">Obnovit</button>
            </div>
        </div>
    </div>

    <!-- Editor modal -->
    <div class="modal-overlay" id="editorModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Upravit pl√°n</h2>
                <p>Upravte pl√°n vizu√°lnƒõ nebo v JSON form√°tu.</p>
            </div>
            <div class="modal-body">
                <!-- Tab switcher -->
                <div class="editor-tabs">
                    <button class="editor-tab active" data-mode="visual">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                        </svg>
                        Vizu√°ln√≠ editor
                    </button>
                    <button class="editor-tab" data-mode="code">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                        JSON k√≥d
                    </button>
                </div>

                <div class="error-summary" id="editorErrorSummary">
                    <h4>Nalezeny chyby:</h4>
                    <ul id="editorErrorList"></ul>
                </div>

                <!-- Visual Editor -->
                <div class="visual-editor">
                    <div class="visual-editor-stats">
                        <div class="visual-editor-stat">Zast√°vky: <strong id="editorStatsStops">0</strong></div>
                        <div class="visual-editor-stat">Noc√≠: <strong id="editorStatsNights">0</strong></div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Z√°kladn√≠ informace</h3>
                        <div class="form-group">
                            <label for="editorPlanName">N√°zev pl√°nu *</label>
                            <input type="text" id="editorPlanName" class="form-input" placeholder="nap≈ô. üè∞ V√≠kend v Praze">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editorPlanDateFrom">Datum od</label>
                                <input type="date" id="editorPlanDateFrom" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="editorPlanDateTo">Datum do</label>
                                <input type="date" id="editorPlanDateTo" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-header">
                            <h3 class="form-section-title">Zast√°vky</h3>
                            <button type="button" class="btn-add-stop" id="editorAddStopBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                P≈ôidat zast√°vku
                            </button>
                        </div>
                        <div class="stops-list" id="editorStopsList"></div>
                    </div>
                </div>

                <!-- Code Editor -->
                <div class="code-editor">
                    <div class="ace-editor-container tall" id="editorJsonContainer"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="copyJsonBtn">Kop√≠rovat JSON</button>
                <button class="btn btn-secondary" id="cancelEditBtn">Zru≈°it</button>
                <button class="btn btn-primary" id="saveJsonBtn">Ulo≈æit zmƒõny</button>
            </div>
        </div>
    </div>

    <!-- Reorder dialog -->
    <div class="reorder-dialog-overlay" id="reorderDialogOverlay">
        <div class="reorder-dialog">
            <h3>√öprava po≈ôad√≠</h3>
            <p>Jak chcete upravit datumy po p≈ôe≈ôazen√≠ zast√°vky?</p>
            <div class="reorder-dialog-options">
                <button class="reorder-dialog-option" data-action="shift">Posunout v≈°e relativnƒõ</button>
                <button class="reorder-dialog-option" data-action="fix">Jen opravit p≈ôekryvy</button>
                <button class="reorder-dialog-option" data-action="none">Nechat beze zmƒõny</button>
            </div>
        </div>
    </div>

    <!-- Application JS (ES Module) -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
