<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cestovn칤 pl치nova캜</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Application CSS -->
    <link rel="stylesheet" href="css/main.css">

    <!-- External Dependencies (CDN) -->
    <!-- LZString pro kompresi URL -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
    <!-- html2canvas pro export PNG -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Ace Editor pro JSON editaci -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/mode-json.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/theme-tomorrow.js"></script>
    <!-- date-fns pro pr치ci s datumy -->
    <script src="https://cdn.jsdelivr.net/npm/date-fns@4.1.0/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@4.1.0/locale/cs/cdn.min.js"></script>
    <!-- Zod pro validaci -->
    <script src="https://cdn.jsdelivr.net/npm/zod@3.24.1/lib/index.umd.min.js"></script>
    <!-- marked pro Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@15.0.6/marked.min.js"></script>
    <!-- DOMPurify pro XSS ochranu -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.3/dist/purify.min.js"></script>
    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.460.0/dist/umd/lucide.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="map"></div>
        <div class="sidebar app-hidden" id="sidebar">
            <div class="header">
                <h1 id="tripTitle"><span class="emoji" id="tripEmoji"></span> <span id="tripName"></span></h1>
                <div class="subtitle" id="tripDates"></div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" id="shareBtn" title="Sd칤let pl치n" aria-label="Sd칤let pl치n">
                    <i data-lucide="share-2"></i>
                </button>
                <button class="action-btn" id="editJsonBtn" title="Upravit pl치n" aria-label="Upravit pl치n">
                    <i data-lucide="pencil"></i>
                </button>
                <div class="dropdown" id="exportDropdown">
                    <button class="action-btn" id="exportBtn" title="Export" aria-label="Export">
                        <i data-lucide="download"></i>
                    </button>
                    <div class="dropdown-content">
                        <button class="dropdown-item" id="exportPngBtn">
                            <i data-lucide="image"></i>
                            <span>Exportovat PNG</span>
                        </button>
                        <button class="dropdown-item" id="printBtn">
                            <i data-lucide="printer"></i>
                            <span>Tisk</span>
                        </button>
                    </div>
                </div>
                <div class="dropdown" id="controlsDropdown">
                    <button class="action-btn" id="controlsBtn" title="Zobrazen칤" aria-label="Zobrazen칤">
                        <i data-lucide="eye"></i>
                    </button>
                    <div class="dropdown-content controls-dropdown">
                        <label class="dropdown-checkbox-item">
                            <input type="checkbox" id="showRoutes" checked>
                            <i data-lucide="git-branch"></i>
                            <span>Zobrazit spojnice trasy</span>
                        </label>
                        <label class="dropdown-checkbox-item">
                            <input type="checkbox" id="showLabels" checked>
                            <i data-lucide="tag"></i>
                            <span>Zobrazit popisky na map캩</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="timeline" id="timeline"></div>

            <div class="stats" id="stats">
                <h3>Statistiky cesty</h3>
                <div class="stat-row">
                    <span class="stat-label">
                        <i data-lucide="moon"></i>
                        Celkov치 d칠lka
                    </span>
                    <span class="stat-value" id="statNights">0 noc칤</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">
                        <i data-lucide="map-pin"></i>
                        Po캜et zast치vek
                    </span>
                    <span class="stat-value" id="statStops">0 m칤st</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">
                        <i data-lucide="route"></i>
                        Celkov치 vzd치lenost
                    </span>
                    <span class="stat-value" id="statDistance">0 km</span>
                </div>
            </div>

            <footer class="app-footer">
                <div class="footer-branding">
                    <span class="footer-name">Planpresso</span>
                    <span class="footer-version">v1.0.0</span>
                </div>
                <button class="footer-info-btn" id="aboutBtn" title="O aplikaci" aria-label="O aplikaci">
                    <i data-lucide="info"></i>
                </button>
            </footer>
        </div>
    </div>

    <!-- About modal -->
    <div class="modal-overlay" id="aboutModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h2>O aplikaci</h2>
            </div>
            <div class="modal-body">
                <div class="about-info">
                    <h3 class="about-title">Planpresso</h3>
                    <p class="about-desc">Vizu치ln칤 pl치nova캜 cest</p>
                    <div class="about-details">
                        <div class="about-row">
                            <span class="about-label">Verze</span>
                            <span class="about-value">1.0.0</span>
                        </div>
                        <div class="about-row">
                            <span class="about-label">Autor</span>
                            <span class="about-value">Pavel Mica</span>
                        </div>
                        <div class="about-row">
                            <span class="about-label">Email</span>
                            <span class="about-value"><a href="mailto:pavel.mica@gmail.com">pavel.mica@gmail.com</a></span>
                        </div>
                        <div class="about-row">
                            <span class="about-label">GitHub</span>
                            <span class="about-value"><a href="https://github.com/Crempa/planpresso" target="_blank">Crempa/planpresso</a></span>
                        </div>
                        <div class="about-row">
                            <span class="about-label">Licence</span>
                            <span class="about-value">MIT</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeAboutBtn">Zav콏칤t</button>
            </div>
        </div>
    </div>

    <!-- Mobiln칤 p콏ep칤na캜 -->
    <button class="mobile-toggle" id="mobileToggle">Zobrazit seznam</button>

    <!-- Toast notifikace -->
    <div class="toast" id="toast"></div>

    <!-- Input modal -->
    <div class="modal-overlay" id="inputModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Zadejte cestovn칤 pl치n</h2>
                <p>Vytvo콏te pl치n vizu치ln캩 nebo vlo쬾e JSON.</p>
            </div>
            <div class="modal-body">
                <!-- Tab switcher -->
                <div class="editor-tabs">
                    <button class="editor-tab active" data-mode="visual">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                        </svg>
                        Vizu치ln칤 editor
                    </button>
                    <button class="editor-tab" data-mode="code">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                        JSON k칩d
                    </button>
                </div>

                <div class="error-summary" id="errorSummary">
                    <h4>Nalezeny chyby:</h4>
                    <ul id="errorList"></ul>
                </div>

                <!-- Visual Editor -->
                <div class="visual-editor">
                    <div class="visual-editor-stats">
                        <div class="visual-editor-stat">Zast치vky: <strong id="inputStatsStops">0</strong></div>
                        <div class="visual-editor-stat">Noc칤: <strong id="inputStatsNights">0</strong></div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Z치kladn칤 informace</h3>
                        <div class="form-group">
                            <label for="inputPlanName">N치zev pl치nu *</label>
                            <input type="text" id="inputPlanName" class="form-input" placeholder="nap콏. 游낋 V칤kend v Praze">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="inputPlanDateFrom">Datum od</label>
                                <input type="date" id="inputPlanDateFrom" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="inputPlanDateTo">Datum do</label>
                                <input type="date" id="inputPlanDateTo" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-header">
                            <h3 class="form-section-title">Zast치vky</h3>
                            <button type="button" class="btn-add-stop" id="inputAddStopBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                P콏idat zast치vku
                            </button>
                        </div>
                        <div class="stops-list" id="inputStopsList"></div>
                    </div>
                </div>

                <!-- Code Editor -->
                <div class="code-editor">
                    <div class="drop-zone" id="dropZone">
                        <div class="drop-zone-icon">游늬</div>
                        <div class="drop-zone-text">P콏et치hn캩te sem JSON soubor</div>
                        <div class="drop-zone-subtext">nebo klikn캩te pro v칳b캩r souboru</div>
                        <input type="file" class="file-input" id="fileInput" accept=".json,application/json">
                    </div>

                    <div class="ace-editor-container" id="jsonInputContainer"></div>

                    <button class="example-toggle" id="exampleToggle">Zobrazit uk치zkov칳 JSON</button>
                    <div class="example-json" id="exampleJson" style="display: none;">
<pre>{
  "name": "游낋 V칤kend v Praze",
  "stops": [
    {
      "name": "Praha - Star칠 M캩sto",
      "lat": 50.0875,
      "lng": 14.4214,
      "dateFrom": "2025-03-01",
      "dateTo": "2025-03-02"
    },
    {
      "name": "Karl코tejn",
      "lat": 49.9394,
      "lng": 14.1883,
      "dateTo": "2025-03-02",
      "notes": "Jednodenn칤 v칳let"
    },
    {
      "name": "Praha - Leti코t캩",
      "lat": 50.1008,
      "lng": 14.2600,
      "dateFrom": "2025-03-02",
      "dateTo": "2025-03-03"
    }
  ]
}</pre>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="useExampleBtn">Pou쮂셦 uk치zku</button>
                <button class="btn btn-primary" id="loadJsonBtn">Na캜칤st pl치n</button>
            </div>
        </div>
    </div>

    <!-- Recovery modal -->
    <div class="modal-overlay" id="recoveryModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Obnovit p콏edchoz칤 pl치n?</h2>
            </div>
            <div class="modal-body">
                <div class="recovery-info">
                    <h3 id="recoveryName"></h3>
                    <p id="recoveryDetails"></p>
                </div>
                <p style="font-size: 0.875rem; color: var(--text-secondary);">
                    M치te ulo쬰n칳 cestovn칤 pl치n z p콏edchoz칤 n치v코t캩vy. Chcete ho obnovit nebo za캜칤t znovu?
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="startNewBtn">Za캜칤t znovu</button>
                <button class="btn btn-primary" id="recoverBtn">Obnovit</button>
            </div>
        </div>
    </div>

    <!-- Editor modal -->
    <div class="modal-overlay" id="editorModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Upravit pl치n</h2>
                <p>Upravte pl치n vizu치ln캩 nebo v JSON form치tu.</p>
            </div>
            <div class="modal-body">
                <!-- Tab switcher -->
                <div class="editor-tabs">
                    <button class="editor-tab active" data-mode="visual">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                        </svg>
                        Vizu치ln칤 editor
                    </button>
                    <button class="editor-tab" data-mode="code">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                        JSON k칩d
                    </button>
                </div>

                <div class="error-summary" id="editorErrorSummary">
                    <h4>Nalezeny chyby:</h4>
                    <ul id="editorErrorList"></ul>
                </div>

                <!-- Visual Editor -->
                <div class="visual-editor">
                    <div class="visual-editor-stats">
                        <div class="visual-editor-stat">Zast치vky: <strong id="editorStatsStops">0</strong></div>
                        <div class="visual-editor-stat">Noc칤: <strong id="editorStatsNights">0</strong></div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Z치kladn칤 informace</h3>
                        <div class="form-group">
                            <label for="editorPlanName">N치zev pl치nu *</label>
                            <input type="text" id="editorPlanName" class="form-input" placeholder="nap콏. 游낋 V칤kend v Praze">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editorPlanDateFrom">Datum od</label>
                                <input type="date" id="editorPlanDateFrom" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="editorPlanDateTo">Datum do</label>
                                <input type="date" id="editorPlanDateTo" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-header">
                            <h3 class="form-section-title">Zast치vky</h3>
                            <button type="button" class="btn-add-stop" id="editorAddStopBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                P콏idat zast치vku
                            </button>
                        </div>
                        <div class="stops-list" id="editorStopsList"></div>
                    </div>
                </div>

                <!-- Code Editor -->
                <div class="code-editor">
                    <div class="ace-editor-container tall" id="editorJsonContainer"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="copyJsonBtn">Kop칤rovat JSON</button>
                <button class="btn btn-secondary" id="cancelEditBtn">Zru코it</button>
                <button class="btn btn-primary" id="saveJsonBtn">Ulo쬴t zm캩ny</button>
            </div>
        </div>
    </div>

    <!-- Reorder dialog -->
    <div class="reorder-dialog-overlay" id="reorderDialogOverlay">
        <div class="reorder-dialog">
            <h3>칔prava po콏ad칤</h3>
            <p>Jak chcete upravit datumy po p콏e콏azen칤 zast치vky?</p>
            <div class="reorder-dialog-options">
                <button class="reorder-dialog-option" data-action="shift">Posunout v코e relativn캩</button>
                <button class="reorder-dialog-option" data-action="fix">Jen opravit p콏ekryvy</button>
                <button class="reorder-dialog-option" data-action="none">Nechat beze zm캩ny</button>
            </div>
        </div>
    </div>

    <!-- Initialize Lucide Icons -->
    <script>lucide.createIcons();</script>

    <!-- Application JS (ES Module) -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
